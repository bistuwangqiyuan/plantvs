# Feature Specification: 竖屏网页版植物大战僵尸游戏

**Feature Branch**: `001-plantsvszombies-3`  
**Created**: 2025-10-08  
**Status**: Draft  
**Input**: 开发竖屏网页版植物大战僵尸游戏，网站命名：plantsVSzombies。网站的主要功能是竖屏模式在线玩植物大战僵尸，且有至少3个关卡以上。进行深入调研，文件层级尽量少，最好不新建文件夹，就在本文件夹开发。详细设计文档包含所有需要的内容，一定要尽量完善，绞尽脑汁，十分全面，完整无缺、不能有遗漏！部署平台为netlify。前端用尽量简单快速的技术，例如h5、css、js、bootstrap。目标用户群体是个人用户。参考的竞品网站和网站风格为植物大战僵尸游戏。计划开发网页端（PC），app等其他形式都不需要，但要能适应手机使用。

## User Scenarios & Testing

### User Story 1 - 新手进入游戏并完成第一关 (Priority: P1)

玩家首次访问网站，看到游戏主界面，通过直观的引导了解游戏玩法，选择植物，放置植物抵御僵尸进攻，成功保卫家园完成第一关。

**Why this priority**: 这是游戏的核心体验和最基本功能，是玩家留存的关键。如果第一关体验不好，玩家会立即离开。这是最小可行产品（MVP）的核心。

**Independent Test**: 可以通过打开网站->点击开始游戏->选择并放置至少一个植物->僵尸出现并被植物击败->显示胜利画面来独立测试。这个流程展示了完整的游戏循环。

**Acceptance Scenarios**:

1. **Given** 玩家打开网站首页，**When** 页面加载完成，**Then** 显示游戏标题"植物大战僵尸"、开始游戏按钮、游戏规则说明按钮
2. **Given** 玩家在主界面，**When** 点击"开始游戏"按钮，**Then** 进入关卡选择界面，显示第一关可玩（已解锁状态）
3. **Given** 玩家进入第一关，**When** 关卡开始，**Then** 显示可用植物卡片（至少包括：豌豆射手、向日葵、坚果墙）、阳光计数器（初始50阳光）、游戏区域（竖屏布局）
4. **Given** 游戏进行中，**When** 天空掉落阳光或向日葵生产阳光，**Then** 玩家可以点击收集，阳光计数器增加对应数值
5. **Given** 玩家有足够阳光，**When** 点击植物卡片然后点击游戏区域的空格，**Then** 植物被种植到该位置，阳光减少对应消耗值
6. **Given** 植物已种植，**When** 僵尸进入植物攻击范围，**Then** 植物自动攻击僵尸（如豌豆射手发射豌豆）
7. **Given** 僵尸血量归零，**When** 僵尸被击败，**Then** 僵尸消失，播放死亡动画
8. **Given** 所有预定僵尸波次已出现且被消灭，**When** 最后一个僵尸消失，**Then** 显示"胜利"提示，展示关卡完成界面，解锁下一关
9. **Given** 僵尸突破防线到达屏幕左侧边界，**When** 僵尸接触边界，**Then** 显示"失败"提示，提供重新开始或返回关卡选择的选项

---

### User Story 2 - 挑战更高难度关卡 (Priority: P2)

玩家完成第一关后，继续挑战第二关和第三关，体验逐渐增加的难度，使用更多种类的植物和策略来应对不同类型和数量的僵尸。

**Why this priority**: 提供游戏深度和持续挑战，让玩家有继续游玩的动力。这是在核心玩法基础上的内容扩展。

**Independent Test**: 可以通过完成第一关->返回关卡选择->选择第二关->体验新僵尸类型和难度->完成第二关->选择第三关->完成第三关来独立测试。

**Acceptance Scenarios**:

1. **Given** 玩家完成第一关，**When** 返回关卡选择界面，**Then** 第二关显示为已解锁状态
2. **Given** 玩家进入第二关，**When** 关卡开始，**Then** 僵尸数量增加，新增至少一种僵尸类型（如路障僵尸），初始阳光保持50
3. **Given** 玩家在第二关，**When** 使用策略性植物布局，**Then** 能够应对更强的僵尸进攻波次
4. **Given** 玩家完成第二关，**When** 返回关卡选择，**Then** 第三关显示为已解锁状态
5. **Given** 玩家进入第三关，**When** 关卡开始，**Then** 僵尸数量和强度进一步增加，新增至少一种新僵尸类型（如铁桶僵尸），可能新增一种植物类型
6. **Given** 玩家在任意关卡，**When** 暂停游戏，**Then** 显示暂停菜单，包括：继续游戏、重新开始、退出到关卡选择
7. **Given** 玩家在关卡进行中，**When** 查看关卡进度，**Then** 显示当前波次和剩余波次（如"第3波/共5波"）

---

### User Story 3 - 了解游戏规则和植物信息 (Priority: P2)

玩家想要了解游戏的详细玩法、每种植物的特性和消耗、每种僵尸的特点，查看图鉴获取详细信息。

**Why this priority**: 帮助玩家更好地理解游戏机制，提升游戏体验和策略深度。这是辅助功能，对核心玩法形成支持。

**Independent Test**: 可以通过主界面->点击"游戏规则"->查看完整规则说明->返回->点击"植物图鉴"->查看各植物详情来独立测试。

**Acceptance Scenarios**:

1. **Given** 玩家在主界面，**When** 点击"游戏规则"按钮，**Then** 显示游戏规则弹窗，包括：游戏目标、阳光系统、植物种植方法、胜利和失败条件
2. **Given** 玩家查看游戏规则，**When** 阅读完毕点击关闭，**Then** 返回主界面
3. **Given** 玩家在主界面，**When** 点击"植物图鉴"按钮，**Then** 显示所有植物列表，包括图标、名称、阳光消耗、冷却时间
4. **Given** 玩家在植物图鉴，**When** 点击某个植物，**Then** 显示该植物的详细信息：完整描述、攻击力、攻击速度、特殊能力
5. **Given** 玩家在游戏中，**When** 长按或悬停在植物卡片上，**Then** 显示该植物的快速提示信息（名称、阳光消耗、简短描述）
6. **Given** 玩家在游戏中，**When** 阳光不足时点击植物卡片，**Then** 显示明确提示"阳光不足！需要X阳光"
7. **Given** 玩家在游戏中，**When** 植物卡片处于冷却状态，**Then** 卡片显示灰色并显示剩余冷却时间

---

### User Story 4 - 移动设备上流畅游玩 (Priority: P3)

玩家使用手机或平板设备访问游戏，在竖屏模式下获得优化的触控体验，流畅完成所有游戏操作。

**Why this priority**: 扩大用户群体，提升移动端用户体验。虽然重要，但桌面端功能完善后再优化移动端体验是合理的开发顺序。

**Independent Test**: 可以通过在手机浏览器打开网站->完成第一关全流程->验证触控操作流畅性->检查界面适配来独立测试。

**Acceptance Scenarios**:

1. **Given** 玩家使用手机访问网站，**When** 页面加载，**Then** 界面自动适应竖屏布局，所有按钮和文字大小适合触控操作
2. **Given** 玩家在移动设备上，**When** 点击植物卡片和游戏格子，**Then** 触控响应灵敏，点击目标足够大（至少44x44px触控区域）
3. **Given** 玩家在手机上游玩，**When** 需要收集阳光，**Then** 阳光大小适合手指点击（至少40px直径）
4. **Given** 玩家在移动设备，**When** 旋转屏幕到横屏，**Then** 显示提示"请使用竖屏模式以获得最佳体验"
5. **Given** 玩家在移动端游玩，**When** 游戏运行，**Then** 帧率保持稳定（至少30fps），动画流畅无卡顿

---

### User Story 5 - 重复游玩和进度管理 (Priority: P3)

玩家可以重复游玩已通关的关卡以提升技巧，游戏进度自动保存在本地，再次访问时可以继续游玩已解锁的关卡。

**Why this priority**: 提升游戏可玩性和用户留存，但不是首次体验的必需功能。

**Independent Test**: 可以通过完成关卡->刷新页面->验证关卡解锁状态保持->重玩已完成关卡来独立测试。

**Acceptance Scenarios**:

1. **Given** 玩家完成某关卡，**When** 刷新浏览器或重新访问网站，**Then** 该关卡保持已解锁状态
2. **Given** 玩家在关卡选择界面，**When** 选择已完成的关卡，**Then** 可以重新游玩该关卡
3. **Given** 玩家想重置进度，**When** 在主界面点击"重置进度"按钮并确认，**Then** 所有关卡（除第一关外）恢复锁定状态
4. **Given** 玩家清除浏览器数据，**When** 再次访问游戏，**Then** 游戏恢复初始状态（仅第一关解锁）

---

### Edge Cases

- 当玩家长时间未操作（超过5秒无输入）时，游戏自动暂停并显示提示"游戏已暂停，点击继续"
- 当玩家在游戏进行中关闭浏览器标签页时，游戏状态不保存，下次进入需重新开始该关卡
- 当玩家尝试在已种植植物的格子上再次种植时，显示提示"该位置已有植物"
- 当玩家尝试在不可种植区域点击时，显示提示"此区域无法种植"
- 当网络加载慢导致资源未加载完成时，显示加载进度条和提示"资源加载中...X%"
- 当浏览器不支持必需的功能（如Canvas）时，显示明确提示"您的浏览器不支持该游戏，请使用现代浏览器（Chrome、Firefox、Safari、Edge）"
- 当僵尸和植物数量过多导致性能下降时，优先保证游戏逻辑准确性，适当降低动画帧率
- 当玩家快速点击导致操作冲突时，以最后一次有效操作为准
- 当玩家阳光数达到上限（9990）时，新阳光不再增加，显示提示"阳光已达上限"
- 当所有格子都已种植植物时，显示提示"已无可用种植位置"

## Requirements

### Functional Requirements

#### 游戏核心机制

- **FR-001**: 系统必须提供竖屏布局的游戏界面，适合在移动设备和桌面浏览器上以竖屏方式游玩
- **FR-002**: 系统必须实现阳光收集机制：天空随机掉落阳光（每5-10秒一个），向日葵植物定期产生阳光（每24秒产生25阳光）
- **FR-003**: 系统必须实现植物种植机制：玩家点击植物卡片后点击游戏格子完成种植，消耗对应阳光，每种植物有冷却时间（5-30秒不等）
- **FR-004**: 系统必须实现至少5种植物类型，每种具有独特功能：
  - 向日葵（生产阳光）：消耗50阳光，冷却7.5秒
  - 豌豆射手（攻击型）：消耗100阳光，冷却7.5秒，每1.4秒发射一颗豌豆，伤害20
  - 坚果墙（防御型）：消耗50阳光，冷却30秒，高血量（4000）
  - 樱桃炸弹（一次性）：消耗150阳光，冷却50秒，爆炸范围内所有僵尸受到1800伤害
  - 寒冰射手（减速攻击）：消耗175阳光，冷却7.5秒，每1.4秒发射寒冰豌豆，伤害20并减速僵尸50%
- **FR-005**: 系统必须实现至少3种僵尸类型，每种具有不同属性：
  - 普通僵尸：血量200，移动速度正常，攻击力100/秒
  - 路障僵尸：血量640，移动速度正常，攻击力100/秒
  - 铁桶僵尸：血量1370，移动速度正常，攻击力100/秒
- **FR-006**: 系统必须实现碰撞检测：僵尸与植物接触时停止移动并开始攻击植物，植物血量归零时消失
- **FR-007**: 系统必须实现射击检测：植物发射的子弹与僵尸碰撞时，僵尸受到伤害，子弹消失
- **FR-008**: 系统必须实现游戏胜利判定：当所有预设波次的僵尸被消灭时，显示胜利界面
- **FR-009**: 系统必须实现游戏失败判定：当任意僵尸到达屏幕最左侧边界时，显示失败界面
- **FR-010**: 系统必须实现游戏网格系统：提供5行3列的种植格子（竖屏布局），僵尸沿行移动

#### 关卡系统

- **FR-011**: 系统必须提供至少3个关卡，每个关卡具有不同的僵尸波次配置和难度
- **FR-012**: 第一关必须包含：初始阳光50，共3波僵尸，仅普通僵尸，总数约15个，可用植物：向日葵、豌豆射手、坚果墙
- **FR-013**: 第二关必须包含：初始阳光50，共4波僵尸，包含普通僵尸和路障僵尸，总数约25个，新增可用植物：樱桃炸弹
- **FR-014**: 第三关必须包含：初始阳光50，共5波僵尸，包含所有僵尸类型，总数约35个，新增可用植物：寒冰射手
- **FR-015**: 系统必须实现关卡解锁机制：初始仅第一关可玩，完成前一关后解锁下一关
- **FR-016**: 系统必须在关卡中显示波次进度：当前波次和总波次数（如"第2波/共5波"）
- **FR-017**: 每波僵尸出现间隔必须为10-20秒，给玩家准备时间

#### 用户界面

- **FR-018**: 系统必须提供主界面，包含：游戏标题、开始游戏按钮、游戏规则按钮、植物图鉴按钮、重置进度按钮
- **FR-019**: 系统必须提供关卡选择界面，显示所有关卡的解锁状态、关卡编号、难度星级
- **FR-020**: 系统必须在游戏界面顶部显示：阳光计数器、当前波次、暂停按钮
- **FR-021**: 系统必须在游戏界面顶部或侧边显示可用植物卡片，包括植物图标、阳光消耗、冷却状态
- **FR-022**: 系统必须实现暂停菜单，包含：继续游戏、重新开始关卡、退出到关卡选择
- **FR-023**: 系统必须在关卡完成后显示结算界面，包含：胜利/失败提示、本关表现（用时、剩余阳光）、下一关按钮、重玩按钮、返回关卡选择按钮
- **FR-024**: 系统必须提供游戏规则说明弹窗，包含：游戏目标、阳光系统说明、植物种植方法、胜利失败条件、操作指南
- **FR-025**: 系统必须提供植物图鉴界面，展示所有植物的详细信息：图标、名称、阳光消耗、冷却时间、攻击力/功能、详细描述

#### 交互与提示

- **FR-026**: 系统必须在所有关键操作时提供即时反馈：阳光不足时提示"阳光不足！需要X阳光"，冷却中时显示剩余时间
- **FR-027**: 系统必须在植物卡片上显示阳光消耗数字
- **FR-028**: 系统必须在植物卡片冷却时显示灰色遮罩和冷却进度
- **FR-029**: 系统必须实现阳光收集动画：点击阳光后飞向阳光计数器并增加数值
- **FR-030**: 系统必须在选中植物卡片后显示可用种植区域的高亮提示
- **FR-031**: 系统必须在鼠标悬停或长按植物卡片时显示快速提示气泡
- **FR-032**: 系统必须在僵尸即将到达边界时显示警告提示"危险！僵尸即将突破防线！"
- **FR-033**: 系统必须在资源加载时显示加载进度条和百分比
- **FR-034**: 系统必须在检测到横屏时显示提示"请使用竖屏模式以获得最佳体验"

#### 响应式与性能

- **FR-035**: 系统必须支持触控操作和鼠标操作，触控目标不小于44x44px
- **FR-036**: 系统必须在移动设备和桌面浏览器上正常运行，自动适应屏幕尺寸
- **FR-037**: 系统必须在主流现代浏览器（Chrome、Firefox、Safari、Edge最新版本）上正常运行
- **FR-038**: 系统必须在游戏运行时保持至少30fps的帧率，确保流畅体验
- **FR-039**: 系统必须在页面加载完成后5秒内进入可交互状态
- **FR-040**: 系统必须优化资源大小，总页面大小不超过3MB，确保快速加载

#### 数据持久化

- **FR-041**: 系统必须使用本地存储（localStorage）保存游戏进度：已解锁关卡列表
- **FR-042**: 系统必须在玩家完成关卡时自动保存进度
- **FR-043**: 系统必须提供重置进度功能，清除所有保存数据并确认操作
- **FR-044**: 系统不得保存正在进行中的关卡状态，玩家关闭页面后需重新开始该关卡

#### 语言与内容

- **FR-045**: 系统必须使用简体中文显示所有文本内容
- **FR-046**: 系统必须提供清晰准确的中文游戏术语和提示信息
- **FR-047**: 所有提示信息必须简洁明确，避免歧义

### Key Entities

- **植物 (Plant)**: 玩家种植的防御单位，具有属性包括：类型（攻击/生产/防御），阳光消耗，冷却时间，血量，攻击力（若适用），攻击速度（若适用），特殊能力（若适用），位置（行列坐标）
- **僵尸 (Zombie)**: 敌对单位，具有属性包括：类型（普通/路障/铁桶等），血量，移动速度，攻击力，当前位置（行和横向坐标），状态（行走/攻击/死亡）
- **阳光 (Sun)**: 游戏货币资源，具有属性包括：数值（25或50），位置（掉落位置或生产位置），状态（可收集/飞向计数器/已收集）
- **子弹 (Projectile)**: 植物发射的攻击单位，具有属性包括：类型（普通豌豆/寒冰豌豆），伤害值，移动速度，当前位置，特殊效果（减速等）
- **关卡 (Level)**: 游戏阶段配置，具有属性包括：关卡编号，解锁状态，初始阳光，僵尸波次配置（每波僵尸类型和数量），可用植物列表，难度星级
- **游戏格子 (Grid Cell)**: 种植区域单元，具有属性包括：行列位置，是否已种植，已种植的植物引用（若有）
- **游戏状态 (Game State)**: 当前游戏进行状态，包括：当前阳光数量，当前波次，已种植的植物列表，场上的僵尸列表，场上的子弹列表，游戏状态（进行中/暂停/胜利/失败）
- **玩家进度 (Player Progress)**: 玩家的游戏进度数据，包括：已解锁的关卡列表

## Success Criteria

### Measurable Outcomes

- **SC-001**: 玩家能够在30秒内完成首次游戏加载并进入可交互的主界面
- **SC-002**: 新玩家能够在3分钟内理解游戏玩法并成功种植第一个植物
- **SC-003**: 玩家能够在10分钟内完成第一关，体验完整的游戏循环
- **SC-004**: 游戏在移动设备和桌面浏览器上都能保持至少30fps的流畅运行
- **SC-005**: 所有关键操作（种植植物、收集阳光、暂停游戏）的响应时间不超过100毫秒
- **SC-006**: 90%的用户操作都能获得明确的视觉或文字反馈提示
- **SC-007**: 页面总资源大小控制在3MB以内，在4G网络下加载时间不超过5秒
- **SC-008**: 游戏能够在至少4种主流浏览器（Chrome、Firefox、Safari、Edge）上正常运行
- **SC-009**: 触控操作目标大小至少为44x44px，确保移动端操作准确性达到95%以上
- **SC-010**: 游戏进度能够可靠保存，玩家刷新页面后解锁状态保持正确
- **SC-011**: 三个关卡提供递进的难度曲线，玩家完成第一关的成功率为80%，第二关60%，第三关40%
- **SC-012**: 所有提示信息使用清晰的简体中文，用户理解度达到95%以上
- **SC-013**: 游戏界面在竖屏模式下所有元素清晰可见，无遮挡，无需滚动即可查看所有关键信息
- **SC-014**: 玩家能够在不查看外部说明的情况下，通过游戏内的规则说明和提示理解所有游戏机制
- **SC-015**: 页面能够成功部署到Netlify并通过HTTPS访问，首次访问成功率达到99%

## Assumptions

1. **技术假设**:
   - 目标用户使用的是支持HTML5 Canvas的现代浏览器
   - 用户设备性能足以运行基本的2D游戏动画
   - 用户网络环境能够在合理时间内（5秒）加载3MB资源

2. **用户行为假设**:
   - 用户熟悉塔防类游戏的基本概念或愿意学习
   - 用户愿意阅读简短的游戏规则说明
   - 用户主要使用竖屏模式游玩（手机）或窗口化浏览器（桌面）

3. **内容假设**:
   - 游戏使用简化的植物大战僵尸机制，不需要完全复制原版所有功能
   - 3个关卡足以展示完整的游戏体验和难度递进
   - 5种植物和3种僵尸足以提供足够的策略深度

4. **部署假设**:
   - Netlify作为静态网站托管平台能够满足性能需求
   - 无需后端服务器，所有功能通过前端实现
   - 使用localStorage的数据持久化方案足够满足需求

5. **设计假设**:
   - 扁平化文件结构（所有文件在根目录）能够满足项目组织需求
   - 使用原生HTML5、CSS、JavaScript（配合Bootstrap）能够实现所有需要的功能
   - 不使用复杂的构建工具或框架，保持开发简单快速

## Dependencies

- **浏览器兼容性**: 需要现代浏览器支持HTML5 Canvas、localStorage、触控事件API
- **网络连接**: 首次加载需要网络连接下载资源，后续游玩可离线
- **Netlify部署**: 需要Netlify账号和基本配置知识
- **游戏素材**: 需要植物、僵尸、UI元素的图形资源（可使用简化的几何图形或免费素材）

## Out of Scope

以下功能明确不在本项目范围内：

- 用户注册和登录系统
- 后端服务器和数据库
- 多人在线对战或排行榜
- 付费功能或内购系统
- 广告系统
- 超过3个关卡的额外关卡（初期版本）
- 无尽模式或挑战模式
- 成就系统
- 音效和背景音乐（可作为未来增强功能）
- 复杂动画效果（保持简洁）
- 国际化多语言支持（仅中文）
- 社交分享功能
- 游戏录制或回放功能

## 软件开发计划

### 开发阶段划分

#### 阶段1: 基础框架搭建 (预计2-3天)

**目标**: 建立项目基础结构和核心游戏循环

**任务**:
1. 创建基础HTML文件结构（index.html），包含Canvas元素和基础DOM结构
2. 创建全局CSS样式文件（styles.css），实现竖屏布局和响应式设计
3. 创建主JavaScript文件（game.js），初始化游戏引擎和主循环
4. 实现游戏状态管理系统（游戏进行/暂停/胜利/失败状态切换）
5. 实现基础的Canvas渲染系统和游戏循环（requestAnimationFrame）
6. 实现5行3列网格系统的数据结构和可视化渲染
7. 实现基础输入处理（鼠标点击和触控事件监听）

**验收标准**:
- 页面能在浏览器中正常打开，显示Canvas游戏区域
- 网格系统清晰可见，能够响应点击事件
- 游戏主循环正常运行，显示帧率稳定在30fps以上

#### 阶段2: 核心游戏机制实现 (预计4-5天)

**目标**: 实现植物、僵尸、阳光等核心游戏元素

**任务**:
1. 实现阳光系统：
   - 天空随机掉落阳光的逻辑和动画
   - 阳光收集的点击检测和收集动画
   - 阳光计数器UI和数值管理
2. 实现植物系统：
   - 定义5种植物的数据结构（属性、行为）
   - 实现植物种植逻辑（选择、放置、消耗阳光、冷却）
   - 实现植物渲染（使用简单图形或占位图）
   - 实现向日葵生产阳光的逻辑
   - 实现豌豆射手的攻击逻辑和子弹系统
   - 实现坚果墙的防御机制
   - 实现樱桃炸弹的爆炸逻辑
   - 实现寒冰射手的减速效果
3. 实现僵尸系统：
   - 定义3种僵尸的数据结构（属性、行为）
   - 实现僵尸生成和波次管理
   - 实现僵尸移动逻辑（沿行移动）
   - 实现僵尸渲染
   - 实现僵尸攻击植物的逻辑
   - 实现僵尸受伤和死亡逻辑
4. 实现碰撞检测系统：
   - 子弹与僵尸的碰撞
   - 僵尸与植物的碰撞
   - 僵尸与边界的碰撞

**验收标准**:
- 能够收集阳光，阳光计数器正确更新
- 能够选择并种植植物，正确消耗阳光和触发冷却
- 僵尸能够正常生成、移动、攻击植物
- 豌豆射手能够发射子弹击中僵尸并造成伤害
- 向日葵能够定期生产阳光
- 所有游戏元素的交互逻辑正确运行

#### 阶段3: 用户界面开发 (预计3-4天)

**目标**: 完善所有用户界面和交互体验

**任务**:
1. 实现主界面（主菜单）：
   - 游戏标题和Logo区域
   - 开始游戏按钮
   - 游戏规则按钮
   - 植物图鉴按钮
   - 重置进度按钮
2. 实现关卡选择界面：
   - 关卡列表展示（3个关卡）
   - 关卡解锁状态显示
   - 关卡难度星级显示
   - 关卡选择交互
3. 实现游戏内UI：
   - 植物卡片栏（顶部或侧边）
   - 植物卡片的阳光消耗显示
   - 植物卡片的冷却状态显示
   - 波次进度显示（"第X波/共Y波"）
   - 暂停按钮
4. 实现暂停菜单：
   - 半透明遮罩层
   - 继续游戏按钮
   - 重新开始按钮
   - 退出到关卡选择按钮
5. 实现关卡结算界面：
   - 胜利/失败提示
   - 关卡数据展示（用时、剩余阳光）
   - 下一关按钮（胜利时）
   - 重玩按钮
   - 返回关卡选择按钮
6. 实现信息弹窗：
   - 游戏规则说明弹窗（完整规则、操作说明）
   - 植物图鉴界面（所有植物详细信息）
   - 植物卡片悬停提示气泡
7. 实现所有操作提示：
   - 阳光不足提示
   - 冷却中提示
   - 位置已占用提示
   - 不可种植区域提示
   - 危险警告提示
   - 横屏提示
8. 使用Bootstrap美化界面，确保视觉效果专业

**验收标准**:
- 所有界面元素清晰可见，布局合理
- 所有按钮可点击，交互流畅
- 所有提示信息能够在正确的时机显示
- 界面风格简洁明快，符合游戏主题
- 移动端和桌面端界面都能正常显示

#### 阶段4: 关卡配置与游戏平衡 (预计2-3天)

**目标**: 设计并实现3个难度递进的关卡

**任务**:
1. 设计关卡数据结构（JSON格式或JavaScript对象）
2. 配置第一关：
   - 初始阳光：50
   - 可用植物：向日葵、豌豆射手、坚果墙
   - 僵尸波次：3波，共15个普通僵尸
   - 僵尸出现时间表
3. 配置第二关：
   - 初始阳光：50
   - 可用植物：向日葵、豌豆射手、坚果墙、樱桃炸弹
   - 僵尸波次：4波，共25个僵尸（普通+路障）
   - 僵尸出现时间表
4. 配置第三关：
   - 初始阳光：50
   - 可用植物：所有5种植物
   - 僵尸波次：5波，共35个僵尸（所有类型）
   - 僵尸出现时间表
5. 实现关卡加载和切换系统
6. 测试并调整关卡难度，确保可玩性和挑战性平衡

**验收标准**:
- 3个关卡能够正常加载和游玩
- 难度呈现递进趋势
- 第一关成功率约80%，第二关60%，第三关40%
- 每个关卡都能正常判断胜利和失败

#### 阶段5: 数据持久化与进度管理 (预计1-2天)

**目标**: 实现游戏进度保存和恢复

**任务**:
1. 实现localStorage读写封装函数
2. 实现关卡解锁状态保存：
   - 完成关卡时自动保存
   - 页面加载时读取保存的进度
3. 实现重置进度功能：
   - 添加确认对话框
   - 清除localStorage数据
   - 重置游戏状态
4. 处理浏览器不支持localStorage的情况（降级方案：仅当前会话有效）

**验收标准**:
- 完成关卡后刷新页面，关卡保持解锁状态
- 重置进度功能能够正确清除所有数据
- 没有localStorage支持时游戏仍能正常运行（不保存进度）

#### 阶段6: 响应式优化与移动端适配 (预计2-3天)

**目标**: 确保游戏在各种设备和屏幕尺寸上都能良好运行

**任务**:
1. 实现响应式布局：
   - 使用CSS媒体查询适配不同屏幕尺寸
   - 调整Canvas大小以适应屏幕
   - 调整UI元素大小和位置
2. 优化触控交互：
   - 确保所有触控目标至少44x44px
   - 实现触控反馈（视觉高亮）
   - 处理触控滚动防止误操作
3. 实现横屏检测和提示
4. 优化移动端性能：
   - 减少不必要的重绘
   - 优化动画性能
   - 调整移动端帧率策略
5. 测试主流移动设备（iOS Safari、Android Chrome）

**验收标准**:
- 游戏在iPhone、Android手机、iPad上都能正常游玩
- 触控操作准确流畅
- 横屏时显示提示信息
- 移动端帧率保持在30fps以上

#### 阶段7: 性能优化与资源压缩 (预计1-2天)

**目标**: 优化加载速度和运行性能

**任务**:
1. 压缩和优化图片资源（如果使用图片）
2. 精简CSS和JavaScript代码
3. 实现资源懒加载（如需要）
4. 优化游戏循环和渲染逻辑：
   - 减少不必要的计算
   - 使用对象池减少垃圾回收
   - 优化碰撞检测算法
5. 实现加载进度显示
6. 测试并优化首次加载时间（目标<5秒）

**验收标准**:
- 页面总大小控制在3MB以内
- 首次加载时间在4G网络下不超过5秒
- 游戏运行流畅，帧率稳定在30fps以上
- 无明显卡顿或延迟

#### 阶段8: 浏览器兼容性测试 (预计1-2天)

**目标**: 确保游戏在主流浏览器上都能正常运行

**任务**:
1. 在以下浏览器测试完整游戏流程：
   - Chrome（最新版）
   - Firefox（最新版）
   - Safari（最新版，macOS和iOS）
   - Edge（最新版）
2. 修复浏览器特定的兼容性问题
3. 实现浏览器能力检测，对不支持的浏览器显示友好提示
4. 测试触控事件和鼠标事件的兼容性

**验收标准**:
- 游戏在所有目标浏览器上都能正常运行
- 不支持的浏览器显示明确的升级提示
- 无明显的浏览器特定bug

#### 阶段9: 完整测试与调试 (预计2-3天)

**目标**: 全面测试游戏功能，修复所有bug

**任务**:
1. 功能测试：
   - 测试所有用户故事的验收场景
   - 测试所有边界情况
   - 测试所有提示信息是否正确显示
2. 压力测试：
   - 测试大量僵尸和植物同时存在的情况
   - 测试长时间游玩的稳定性
3. 用户体验测试：
   - 新手是否能快速理解玩法
   - 操作是否直观流畅
   - 提示信息是否清晰有效
4. 记录并修复所有发现的bug
5. 优化游戏平衡性和可玩性

**验收标准**:
- 所有功能需求都已实现并通过测试
- 所有已知bug都已修复
- 游戏体验流畅，无明显问题
- 所有成功标准都已达成

#### 阶段10: 部署与发布 (预计1天)

**目标**: 将游戏部署到Netlify并确保正常访问

**任务**:
1. 准备部署文件：
   - 整理所有必需文件（HTML、CSS、JS、资源文件）
   - 创建netlify.toml配置文件（如需要）
   - 确保所有文件路径正确
2. 注册Netlify账号并创建新站点
3. 上传文件到Netlify：
   - 通过拖放上传或Git部署
   - 配置自定义域名（如需要）
4. 测试线上版本：
   - 在多个设备和浏览器测试线上版本
   - 确认HTTPS访问正常
   - 确认所有资源加载正常
5. 优化Netlify配置：
   - 启用资源压缩
   - 配置缓存策略
   - 设置重定向规则（如需要）
6. 创建简单的README.md文档说明项目

**验收标准**:
- 游戏成功部署到Netlify并可通过URL访问
- HTTPS访问正常
- 所有功能在线上环境正常运行
- 加载速度符合要求

### 文件结构规划

根据要求，采用扁平化文件结构，所有文件放在项目根目录：

```
plantvs/
├── index.html          # 主HTML文件，包含所有页面结构
├── styles.css          # 全局样式文件
├── game.js             # 主游戏逻辑和引擎
├── plants.js           # 植物相关逻辑（可选，或合并到game.js）
├── zombies.js          # 僵尸相关逻辑（可选，或合并到game.js）
├── ui.js               # UI交互逻辑（可选，或合并到game.js）
├── levels.js           # 关卡配置数据
├── README.md           # 项目说明文档
├── netlify.toml        # Netlify部署配置（可选）
└── assets/             # 可选的资源文件夹（如果需要图片等资源）
    ├── plant-*.png     # 植物图片
    ├── zombie-*.png    # 僵尸图片
    └── ui-*.png        # UI元素图片
```

**注**: 为了尽量减少文件数量，可以将plants.js、zombies.js、ui.js的内容直接合并到game.js中。如果不使用图片资源而是用Canvas绘制几何图形，可以完全省略assets文件夹。

### 开发工具与技术选型

- **HTML5**: 页面结构
- **CSS3**: 样式和布局，使用Flexbox/Grid实现响应式
- **Bootstrap 5**: UI组件和响应式栅格系统（通过CDN引入）
- **原生JavaScript (ES6+)**: 游戏逻辑，无需框架
- **Canvas API**: 游戏渲染
- **localStorage API**: 数据持久化
- **代码编辑器**: 任意（VS Code推荐）
- **浏览器开发工具**: Chrome DevTools或Firefox Developer Tools
- **版本控制**: Git（可选，用于Netlify自动部署）
- **部署平台**: Netlify

### 总预计开发时间

总计约18-25天，适合1-2人小团队或个人开发者完成。

### 开发优先级建议

1. **高优先级（必须完成）**: 阶段1-5，实现核心游戏功能和基本UI
2. **中优先级（重要）**: 阶段6-8，确保跨设备兼容性和性能
3. **标准流程（必要）**: 阶段9-10，测试和部署

可以按照阶段顺序开发，每完成一个阶段进行验收测试，确保质量后再进入下一阶段。
